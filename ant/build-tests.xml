<?xml version="1.0"?>
<!-- Copyright 2016: Thomson Reuters. All Rights Reserved. Proprietary and Confidential information of Thomson Reuters. Disclosure, Use or Reproduction without the written authorization of Thomson Reuters is prohibited.-->

<!--
	Common unit-test related targets for the Dockets projects
-->
<project name="BuildDocketsTests">

	<property file="ant/build.properties" />

	<path id="test.classpath">
		<fileset dir="../${proj.core}/lib">
			<include name="**/*.jar" />
		</fileset>
		<pathelement location="../${proj.core}/${dir.target}/${proj.core}.jar" />
		<pathelement location="../ProductBuilder/${dir.target}/ProductBuilder.jar" />
		<pathelement location="../DocketsServices/${dir.target}/DocketsServices.jar" />
		<pathelement path="../IntermediateConversion/build-sandbox" />
		<pathelement path="${dir.sandbox}" />
		<pathelement path="${dir.sandbox.classes}" />
		<pathelement path="${dir.test.classes}" />
	</path>

	<target name="compileUnitTests">
		<javac destdir="${dir.test.classes}" source="${java.source.version}" target="${java.target.version}" debug="${java.debug}" includeantruntime="false">
			<src path="${dir.test.source}" />
			<classpath refid="test.classpath">
			</classpath>
		</javac>
		<copy todir="${dir.test.classes}" description="Copy supporting XML and other non-java test related files into the com tree (where the .class files are) on the classpath.">
			<fileset dir="${dir.test.source}" excludes="**/*.java" />
		</copy>
	</target>


	<target name="compileIntegrationTests">
		<echo level="info" message="${dir.test.integration}" />
		<javac destdir="${dir.test.classes}" source="${java.source.version}" target="${java.target.version}" debug="${java.debug}" includeantruntime="false">
			<src path="${dir.test.integration}" />
			<classpath refid="test.classpath">
			</classpath>
		</javac>
		<copy todir="${dir.test.classes}" description="Copy supporting XML and other non-java test related files into the com tree (where the .class files are) on the classpath.">
			<fileset dir="${dir.test.integration}" excludes="**/*.java" />
		</copy>
	</target>

	<!-- 
		In future if we ever need to run just specific test like gold standard test compile entire integration packet but run specific classes by providing more granular class path along with name
	-->
	<target name="runTests">
		<junit dir="." fork="on" forkmode="once" haltonfailure="false" showoutput="on" printsummary="on" haltonerror="false" description="true" failureproperty="tests.failed">
			<!--jvmarg value="-Dfile.encoding=UTF-8 -Denvironment=dev"/-->
			<classpath refid="test.classpath" />
			<formatter type="xml" usefile="yes" />
			<batchtest todir="${dir.test.results}">
				<fileset dir="${dir.test.classes}">
					<include name="**/*Test.class" />
				</fileset>
			</batchtest>
		</junit>

		<fail if="tests.failed">
	      One or more tests failed!
	      For more information check: ${dir.test.results}
	    </fail>
	</target>

</project>
